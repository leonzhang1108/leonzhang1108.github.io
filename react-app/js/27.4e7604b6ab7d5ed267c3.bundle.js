(window.webpackJsonp=window.webpackJsonp||[]).push([[27,67],{354:function(e,t,i){},95:function(e,t,i){"use strict";i.r(t);var n=i.p+"img/justice_league.052b3.jpg",s=i(21),o=i(0),r=i.n(o);i(354);
/*!
 * imgzoomer v1.0.2
 * https://github.com/leonzhang1108/imgzoomer
 * Released under the MIT License.
 */
function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i){return t&&h(e.prototype,t),i&&h(e,i),e}var l,c=function(){function e(t,i){a(this,e),this.canvas=null,this.ctx=null,this.times=1,this.outerTimes,this.currentTimes=1,this.lastX=0,this.lastY=0,this.lastMouseX=0,this.lastMouseY=0,this.top=null,this.left=null,this.img=null,this.zoomImg=null,this.callback=i.callback,this.svgDragging=!1,this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleMouseWheel=this.handleMouseWheel.bind(this),this.initCanvas(t,i)}return u(e,[{key:"initCanvas",value:function(e,t){var i=document.querySelector("#".concat(e));this.canvas=i,this.ctx=i.getContext("2d"),t?this.calculateCanvasSize(t):console.error("width and height need to specify")}},{key:"calculateCanvasSize",value:function(e){var t=e.width,i=e.height,n=this.canvas;n&&(this.wrapperWidth=n.width=t,this.wrapperHeight=n.height=i)}},{key:"draw",value:function(e){var t=this,i=this.img=new Image;i.onload=function(){t.render(),t.removeEvents(),t.initEvents()},i.src=e}},{key:"render",value:function(e){var t=0,i=0;e&&(t=e.left,i=e.top);var n=this.top,s=this.left,o=this.currentTimes,r=this.times,a=this.wrapperWidth,h=this.wrapperHeight,u=this.ctx,l=this.zoomImg||this.calculate(this.img),c=l.width,d=l.height;e||(n&&s?(t=s,i=n):(t=(a-c)/2,i=(h-d)/2)),t+=((this.lastMouseX||0)-t)*(1-o),i+=((this.lastMouseY||0)-i)*(1-o),this.lastX=t,this.lastY=i,u.clearRect(0,0,a,h),u.drawImage(this.img,t,i,c*r,d*r),this.callback&&this.callback({times:this.outerTimes||1,top:i,left:t})}},{key:"drag",value:function(e){var t=e.offsetX,i=e.offsetY,n=this.top,s=this.left+t-this.movedX,o=n+i-this.movedY;this.render({left:s,top:o})}},{key:"zoom",value:function(e){var t=this,i=Math.pow(1.1,e.wheelDelta/300);this.times*=i,this.currentTimes*=i,this.outerTimes*=i,requestAnimationFrame((function(e){t.render()}))}},{key:"calculate",value:function(e){var t=this.wrapperWidth,i=this.wrapperHeight,n=e.width,s=e.height,o=s/n-i/t,r=s/n;return this.zoomImg||(this.zoomImg={},o>0?(this.outerTimes=i/s,this.zoomImg.height=i,this.zoomImg.width=i/r):(this.outerTimes=t/n,this.zoomImg.width=t,this.zoomImg.height=t*r)),this.zoomImg}},{key:"initEvents",value:function(){var e=this.canvas.parentElement.parentElement;e.addEventListener("wheel",this.handleMouseWheel),e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("mousemove",this.handleMouseMove),e.addEventListener("mouseup",this.handleMouseUp)}},{key:"removeEvents",value:function(){var e=this.canvas.parentElement.parentElement;e.removeEventListener("wheel",this.handleMouseWheel),e.removeEventListener("mousedown",this.handleMouseDown),e.removeEventListener("mousemove",this.handleMouseMove),e.removeEventListener("mouseup",this.handleMouseUp)}},{key:"handleMouseWheel",value:function(e){this.lastMouseX&&this.lastMouseY&&(e.preventDefault(),e.stopPropagation(),this.zoom(e))}},{key:"handleMouseDown",value:function(e){var t=e.offsetX,i=e.offsetY;this.clicked=!0,this.movedX=t,this.movedY=i,this.resetTopLeft()}},{key:"handleMouseMove",value:function(e){if(!this.svgDragging){var t=e.offsetX,i=e.offsetY,n=this.currentTimes;this.lastMouseX=t,this.lastMouseY=i,1!==n&&(this.currentTimes=1),this.clicked?this.drag(e):this.resetTopLeft()}}},{key:"handleMouseUp",value:function(e){this.svgDragging=!1,this.clicked=!1,this.movedX=0,this.movedY=0,this.resetTopLeft()}},{key:"resetTopLeft",value:function(){var e=this.left,t=this.top,i=this.lastX,n=this.lastY;i===e&&n===t||(this.left=i,this.top=n)}}]),e}(),d=function(e){return void 0===e},v=function(){function e(t,i){var n=i.imgZoomer,s=i.pointsList;a(this,e),n?(this.pointsList=s||[],this.blockList=[],this.temp=[],this.dragging=!1,this.clicked=!1,this.polygonMove=!1,this.imgZoomer=n,this.mousedownX=0,this.mousedownY=0,this.circleDragging=!1,this.group=void 0,this.index=void 0,this.isRectangle=!1,this.svgMousedown=this.svgMousedown.bind(this),this.svgMousemove=this.svgMousemove.bind(this),this.svgMouseup=this.svgMouseup.bind(this),this._wrapper=document.querySelector("#".concat(t)),this.imgZoomer.callback=this.rerender.bind(this),this.removeEvents(),this.initEvents()):console.error("imgZoomer need to specify")}return u(e,[{key:"initEvents",value:function(){this._wrapper.addEventListener("mousedown",this.svgMousedown),this._wrapper.addEventListener("mousemove",this.svgMousemove),this._wrapper.addEventListener("mouseup",this.svgMouseup)}},{key:"removeEvents",value:function(){this._wrapper.removeEventListener("mousedown",this.svgMousedown),this._wrapper.removeEventListener("mousemove",this.svgMousemove),this._wrapper.removeEventListener("mouseup",this.svgMouseup)}},{key:"svgMousedown",value:function(){this.clicked=!0}},{key:"setIsRectangle",value:function(e){this.isRectangle=e||!1}},{key:"svgMousemove",value:function(e){var t=this;if(this.clicked&&(this.dragging=!0),this.circleDragging){var i=e.offsetX,n=e.offsetY,s=this.group,o=this.index,r=this.times,a=i-this.mousedownX,h=n-this.mousedownY;if(d(o)||d(s)){var u=this.temp[o],l=u.x,c=u.y;this.temp[o]={x:l+a/r,y:c+h/r},this.rerenderTempPoints(),this.resetMousedownPoint(e)}else{var v=this.pointsList[s][o],m=v.x,p=v.y;this.pointsList[s][o]={x:m+a/r,y:p+h/r},this.renderSingleArea(this.pointsList[s],s),this.resetMousedownPoint(e)}}if(this.imgZoomer.svgDragging&&!this.circleDragging){var g=e.offsetX,f=e.offsetY,y=this.index,w=g-this.mousedownX,k=f-this.mousedownY;this.pointsList[y]=this.pointsList[y].map((function(e){var i=e.x,n=e.y;return{x:i+w/t.times,y:n+k/t.times}})),this.renderSingleArea(this.pointsList[y],y),this.resetMousedownPoint(e)}if(this.isRectangle&&this.temp.length){var E=this.temp[0],x=E.x,M=E.y,b=this.calculateAddPoint(e),L=b.x,P=b.y;this.temp=function(e){var t=e.x0,i=e.y0,n=e.x1,s=e.y1;return[{x:t,y:i},{x:n,y:i},{x:n,y:s},{x:t,y:s},{x:t,y:i}]}({x0:x,y0:M,x1:L,y1:P}),this.rerenderTempPoints()}}},{key:"svgMouseup",value:function(e){if(this.clicked=!1,this.circleDragging=!1,this.imgZoomer.svgDragging=!1,this.group=void 0,this.index=void 0,!this.isDragging())switch(e.target.tagName){case"svg":2!==e.button&&this.addTempPoint(e);break;case"circle":this.isRectangle&&this.temp.length&&(this.temp.splice(this.temp.length-1),this.addPointList())}}},{key:"isDragging",value:function(){var e=this.dragging;return this.dragging=!1,e}},{key:"addPointList",value:function(){this.temp.length<3||(this.pointsList.push(this.temp),this.removeTempGroup(),this.rerenderExsitPoints())}},{key:"removeTempGroup",value:function(){this.temp=[];var e=document.querySelector("#temp");e&&e.remove()}},{key:"removeGroup",value:function(e){this.pointsList[e]=[];var t=document.querySelector("#svginner-".concat(e));t&&t.remove()}},{key:"addTempPoint",value:function(e){var t=this.calculateAddPoint(e);this.temp.push(t),this.rerenderTempPoints()}},{key:"calculateAddPoint",value:function(e){var t=e.clientX,i=e.clientY,n=this._wrapper.getBoundingClientRect(),s=n.left,o=n.top,r=this.top,a=this.left,h=this.times;return{x:(t-(a||0)-s)/h,y:(i-(r||0)-o)/h}}},{key:"createSVGElement",value:function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}},{key:"rerender",value:function(e){var t=e.times,i=e.top,n=e.left;this.times=t,this.top=i,this.left=n,this.rerenderExsitPoints(),this.rerenderTempPoints()}},{key:"rerenderExsitPoints",value:function(){this.pointsList.forEach(this.renderSingleArea.bind(this))}},{key:"renderSingleArea",value:function(e,t){var i=this,n=e.length,s=this.calculate(e);if(this.pointsList[t].length){var o=this.renderGroup(t),r=o.getElementsByTagName("polygon")[0];this.reRenderPolygon({polygon:r,g:o,index:t}),s.forEach((function(e,r){var a=o.getElementsByTagName("line")[r],h=o.getElementsByTagName("circle")[r],u=r===n-1?s[0]:s[r+1],l=u.x,c=u.y;i.reRenderLine({line:a,p:e,p2:{x2:l,y2:c},g:o,i:r}),i.reRenderCircle({circle:h,p:e,g:o,i:r,index:t})}))}}},{key:"rerenderTempPoints",value:function(){var e=this,t=this.renderTempGroup(),i=this.calculate(this.temp),n=i.length;i.forEach((function(s,o){var r=t.getElementsByTagName("circle")[o],a=t.getElementsByTagName("line")[o],h=o===n-1?i[0]:i[o+1],u=h.x,l=h.y,c=e.reRenderCircle({circle:r,p:s,g:t,i:o});0===o&&c.addEventListener("mouseup",(function(){return!e.dragging&&e.addPointList.call(e)})),o!==n-1&&e.reRenderLine({line:a,p:s,p2:{x2:u,y2:l},g:t})}))}},{key:"renderGroup",value:function(e){var t=this._wrapper.querySelector("#svginner-".concat(e));return t||((t=this.createSVGElement("g")).id="svginner-".concat(e),t.setAttribute("class","polygon"),this._wrapper.appendChild(t)),t}},{key:"renderTempGroup",value:function(){var e=document.querySelector("#temp");return e||((e=this.createSVGElement("g")).id="temp",this._wrapper.appendChild(e)),e}},{key:"reRenderPolygon",value:function(e){var t=this,i=e.polygon,n=e.g,s=e.index;i||((i=this.createSVGElement("polygon")).setAttribute("fill","rgb(56, 120, 196, .5)"),i.setAttribute("cursor","move"),i.addEventListener("mousedown",(function(e){t.imgZoomer.svgDragging=!0,t.index=e.target.parentElement.id.split("-")[1],t.resetMousedownPoint(e)})),i.addEventListener("mouseup",(function(e){t.imgZoomer.svgDragging=!1,t.index=void 0})),i.addEventListener("contextmenu",(function(e){t.removeGroup(s),e.preventDefault()})),n.appendChild(i)),i.setAttribute("points",this.convertPoints2String(this.calculate(this.pointsList[s])))}},{key:"resetMousedownPoint",value:function(e){var t=e.offsetX,i=e.offsetY;this.mousedownX=t,this.mousedownY=i}},{key:"reRenderLine",value:function(e){var t=this,i=e.line,n=e.p,s=n.x,o=n.y,r=e.p2,a=r.x2,h=r.y2,u=e.g,l=e.i;i||((i=this.createSVGElement("line")).setAttribute("stroke","rgb(211, 220, 230)"),this.setStrokeWidth({line:i,v:2}),!d(l)&&i.setAttribute("index",l),i.addEventListener("mouseover",(function(){return t.setStrokeWidth({line:i,v:5})})),i.addEventListener("mouseout",(function(){return t.setStrokeWidth({line:i,v:2})})),i.addEventListener("click",(function(e){var i=e.target,n=i.parentElement.id;if("temp"!==n){var s=n.split("-")[1],o=i.getAttribute("index"),r=t.calculateAddPoint(e);t.pointsList[s].splice(parseInt(o)+1,0,r),t.renderSingleArea(t.pointsList[s],s)}})),u.append(i)),i.setAttribute("x1",s),i.setAttribute("y1",o),i.setAttribute("x2",a),i.setAttribute("y2",h)}},{key:"setStrokeWidth",value:function(e){var t=e.line,i=e.v;t.setAttribute("stroke-width",i)}},{key:"reRenderCircle",value:function(e){var t=this,i=e.circle,n=e.p,s=n.x,o=n.y,r=e.g,a=e.i,h=e.index;return i||((i=this.createSVGElement("circle")).setAttribute("fill","rgb(89, 249, 46)"),i.setAttribute("cursor","move"),!d(a)&&i.setAttribute("index",a),!d(h)&&i.setAttribute("group",h),i.addEventListener("mousedown",(function(e){t.imgZoomer.svgDragging=!0,t.circleDragging=!0,!d(h)&&(t.group=h),t.index=d(a)?e.target.getAttribute("index"):a,t.resetMousedownPoint(e)})),i.addEventListener("mouseup",(function(){t.imgZoomer.svgDragging=!1,t.circleDragging=!1})),r.append(i)),i.setAttribute("r",6),i.setAttribute("cx",s),i.setAttribute("cy",o),i}},{key:"calculate",value:function(e){return e.map(this.calculateSinglePoint.bind(this))}},{key:"calculateSinglePoint",value:function(e){var t=this.top,i=this.left,n=this.times;return{x:i+e.x*n,y:t+e.y*n}}},{key:"convertPoints2String",value:function(e){return e.map((function(e){var t=e.x,i=e.y;return"".concat(t,",").concat(i)})).join(" ")}}]),e}(),m=i(55),p=i.n(m),g=(i(61),i(341)),f=i.n(g),y=(i(340),l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getPoints=function(){f.a.info({title:"Points",content:r.a.createElement("div",null,t.svgLabelEditor.pointsList.map((function(e,t){return r.a.createElement("div",{key:t},"[",e.map((function(e,t){var i=e.x,n=e.y;return r.a.createElement("div",{key:t},"(",i,", ",n,")")})),"]")})))})},t}return y(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.height,i=e.width,s=c,o=v;this.imgZoomer=new s("canvas",{width:i,height:t}),this.imgZoomer.draw(n),this.svgLabelEditor=new o("svg-wrapper",{imgZoomer:this.imgZoomer,pointsList:[[{x:415.84196194762626,y:147.26284891271456},{x:600.8419619476263,y:190.26284891271456},{x:653.8419619476264,y:352.26284891271456},{x:376.1088135552601,y:340.5695301104572}],[{x:940.7072245800349,y:338.003545055495},{x:1013.1629207825664,y:471.97822859979857},{x:880.5553258458576,y:447.37063366308996}]]})},t.prototype.componentWillUnmount=function(){this.imgZoomer.removeEvents(),this.svgLabelEditor.removeEvents()},t.prototype.render=function(){return r.a.createElement("div",{className:"widget-wrapper"},r.a.createElement("svg",{id:"svg-wrapper"}),r.a.createElement("canvas",{id:"canvas"}),r.a.createElement(p.a,{className:"btn",type:"primary",onClick:this.getPoints},"get points"))},t}(r.a.Component);t.default=s.a.connect({component:w,mapStateToProps:function(e){return{height:e.common.contentHeight,width:e.common.contentWidth}}})}}]);
//# sourceMappingURL=27.4e7604b6ab7d5ed267c3.bundle.js.map