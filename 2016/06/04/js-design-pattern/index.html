<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>js设计模式 | Leonzhang&#39;s blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="All Hail JLA" />
  

  <meta name="description" content="单例模式// 第一种var singleton = function( fn )&amp;#123;    var result;    return function()&amp;#123;        return result || ( result = fn.apply( this, arguments ) );    &amp;#125;&amp;#125;var createMask = singleton(fun">
<meta property="og:type" content="article">
<meta property="og:title" content="js设计模式">
<meta property="og:url" content="http://6rina.cc/2016/06/04/js-design-pattern/index.html">
<meta property="og:site_name" content="Leonzhang&#39;s blog">
<meta property="og:description" content="单例模式// 第一种var singleton = function( fn )&amp;#123;    var result;    return function()&amp;#123;        return result || ( result = fn.apply( this, arguments ) );    &amp;#125;&amp;#125;var createMask = singleton(fun">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-09-14T06:51:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="js设计模式">
<meta name="twitter:description" content="单例模式// 第一种var singleton = function( fn )&amp;#123;    var result;    return function()&amp;#123;        return result || ( result = fn.apply( this, arguments ) );    &amp;#125;&amp;#125;var createMask = singleton(fun">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/atom.xml"
            rel="noopener noreferrer"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>




<div class="content content-post CENTER">
   <article id="post-js-design-pattern" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">js设计模式</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2016.06.04</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Leon Zhang</span>
        </span>
      

      


      
        <span>
          <i class="icon-comment"></i>
          <a href="http://leonzh.cc/2016/06/04/js-design-pattern/#disqus_thread"></a>
        </span>
      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 第一种</span></span><br><span class="line"><span class="keyword">var</span> singleton = <span class="function"><span class="keyword">function</span>(<span class="params"> fn </span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> result || ( result = fn.apply( <span class="keyword">this</span>, <span class="built_in">arguments</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> createMask = singleton(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.body.appendChild( <span class="built_in">document</span>.createElement(<span class="string">'div'</span>) );</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 第二种</span></span><br><span class="line"><span class="keyword">var</span> Singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> instantce</span><br><span class="line">    <span class="keyword">var</span> init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getInstance: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!instantce)&#123;</span><br><span class="line">                instantce = init()</span><br><span class="line">                <span class="keyword">return</span> instantce</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instantce</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="构造函数模式"><a href="#构造函数模式" class="headerlink" title="构造函数模式"></a>构造函数模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Batman</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(vehicle, opponent, helper) &#123;</span><br><span class="line">        <span class="keyword">this</span>.vehicle = vehicle</span><br><span class="line">        <span class="keyword">this</span>.opponent = opponent</span><br><span class="line">        <span class="keyword">this</span>.helper = helper</span><br><span class="line">    &#125;</span><br><span class="line">    doSomething() &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="keyword">this</span>.helper +<span class="string">' is driving '</span>+ <span class="keyword">this</span>.vehicle + <span class="string">' fighting against '</span>+ <span class="keyword">this</span>.opponent</span><br><span class="line">        <span class="built_in">console</span>.log(result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> robin = <span class="keyword">new</span> Batman(<span class="string">'the bat'</span>, <span class="string">'Joker'</span>, <span class="string">'Robin'</span>)</span><br><span class="line">robin.doSomething()</span><br><span class="line"><span class="keyword">var</span> catwoman = <span class="keyword">new</span> Batman(<span class="string">'bat mobile'</span>, <span class="string">'Poison Ivy'</span>, <span class="string">'Cat Woman'</span>)</span><br><span class="line">catwoman.doSomething()</span><br></pre></td></tr></table></figure>
<h2 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Batman</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">this</span>.son = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">this</span>.roar = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BatmanBuilder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.batman = <span class="keyword">new</span> Batman()</span><br><span class="line">    &#125;</span><br><span class="line">    setSex(sex) &#123;</span><br><span class="line">        <span class="keyword">this</span>.batman.sex = sex</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    setSon(son) &#123;</span><br><span class="line">        <span class="keyword">this</span>.batman.son = son</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    setRoar(roar) &#123;</span><br><span class="line">        <span class="keyword">this</span>.batman.roar = roar</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    build() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.batman</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> builder = <span class="keyword">new</span> BatmanBuilder()</span><br><span class="line">builder.setSex(<span class="string">'man'</span>)</span><br><span class="line">builder.setSon(<span class="string">'robin'</span>)</span><br><span class="line">builder.setRoar(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'ironman sucks'</span>))</span><br><span class="line"><span class="keyword">const</span> batman = builder.build()</span><br><span class="line">batman.roar()</span><br></pre></td></tr></table></figure>
<h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> batman = &#123;&#125;</span><br><span class="line">batman.fight = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'batman fight'</span></span><br><span class="line">&#125;</span><br><span class="line">batman.eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'batman eat'</span></span><br><span class="line">&#125;</span><br><span class="line">batman.sleep = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'batman sleep'</span></span><br><span class="line">&#125;</span><br><span class="line">batman.factory = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> batman[type]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fight = batman.factory(<span class="string">'fight'</span>)</span><br><span class="line">fight()</span><br></pre></td></tr></table></figure>
<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> AbstractVehicleFactory = <span class="function"><span class="keyword">function</span>(<span class="params">subClass, superType</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> AbstractVehicleFactory[superType] == <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="comment">// 缓存类</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 继承父类属性和方法</span></span><br><span class="line">        F.prototype = <span class="keyword">new</span> AbstractVehicleFactory[superType]();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将子类constructor指向子类</span></span><br><span class="line">        F.constructor = subClass;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 子类原型继承”父类“</span></span><br><span class="line">        subClass.prototype = <span class="keyword">new</span> F();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'未创建该抽象类'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 小汽车抽象类</span></span><br><span class="line">AbstractVehicleFactory.Car = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.type = <span class="string">'car'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">AbstractVehicleFactory.Car.prototype = &#123;</span><br><span class="line">  getPrice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'抽象方法不能调用'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  getSpeed: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'抽象方法不能调用'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 宝马汽车子类</span></span><br><span class="line"><span class="keyword">var</span> BMW = <span class="function"><span class="keyword">function</span>(<span class="params">price, speed</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.price = price;</span><br><span class="line">  <span class="keyword">this</span>.speed = speed;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">AbstractVehicleFactory(BMW, <span class="string">'Car'</span>);</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> BMW(<span class="number">100</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.getPrice());</span><br><span class="line"><span class="built_in">console</span>.log(a.type);</span><br></pre></td></tr></table></figure>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">```js</span><br><span class="line">// 观察者列表</span><br><span class="line">class ObserverList &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.observerList = []</span><br><span class="line">    &#125;</span><br><span class="line">    add(obj) &#123;</span><br><span class="line">        return this.observerList.add(obj)</span><br><span class="line">    &#125;</span><br><span class="line">    count() &#123;</span><br><span class="line">        return this.onserverList.length</span><br><span class="line">    &#125;</span><br><span class="line">    get(index) &#123;</span><br><span class="line">        if( index &gt; -1 &amp;&amp; index &lt; this.observerList.length )&#123;</span><br><span class="line">            return this.observerList[index]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    indexOf(obj, startIndex) &#123;</span><br><span class="line">        var i = startIndex</span><br><span class="line">        while( i &lt; this.observerList.length )&#123;</span><br><span class="line">            if( this.observerList[i] === obj )&#123;</span><br><span class="line">                return i</span><br><span class="line">            &#125;</span><br><span class="line">            i++</span><br><span class="line">        &#125;</span><br><span class="line">        return -1</span><br><span class="line">    &#125;</span><br><span class="line">    removeAt(index) &#123;</span><br><span class="line">        this.observerList.splice(index, 1)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Subject() &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.observers = new ObserverList()</span><br><span class="line">    &#125;</span><br><span class="line">    addObserver(observer) &#123;</span><br><span class="line">        this.observers.add(observer)</span><br><span class="line">    &#125;</span><br><span class="line">    removeObserver(observer) &#123;</span><br><span class="line">        this.observers.removeAt(this.observers.indexOf(observer, 0))</span><br><span class="line">    &#125;</span><br><span class="line">    notify(context) &#123;</span><br><span class="line">        var observerCount = this.observers.count()</span><br><span class="line">        for(var i = 0; i &lt; observerCount; i++)&#123;</span><br><span class="line">            this.observers.get(i).update(context)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Observer &#123;</span><br><span class="line">    this.update() &#123;</span><br><span class="line">        console.log(&apos;observer update&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Publish/Subscribe Pattern</span></span><br><span class="line"><span class="comment"> * 订阅中心</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PubSub</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.handlers = [];</span><br><span class="line">    &#125;</span><br><span class="line">    subscribe(event, handler, context) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> context === <span class="string">'undefined'</span>) &#123; context = handler; &#125;</span><br><span class="line">        <span class="keyword">this</span>.handlers.push(&#123; <span class="attr">event</span>: event, <span class="attr">handler</span>: handler.bind(context) &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    publish(event, args) &#123;</span><br><span class="line">        <span class="keyword">this</span>.handlers.forEach(<span class="function"><span class="params">topic</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (topic.event === event) &#123;</span><br><span class="line">                topic.handler(args)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Simple ChatRoom Class</span></span><br><span class="line"><span class="comment"> * uses the PubSub Class to notif y other users when a message is sent.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChatRoom</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.pubsub = <span class="keyword">new</span> PubSub();</span><br><span class="line">        <span class="keyword">this</span>.pubsub.subscribe(<span class="string">'message'</span>, <span class="keyword">this</span>.emitMessage, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    emitMessage(msg) &#123;</span><br><span class="line">        <span class="built_in">console</span>.group(<span class="string">'PubSub'</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'user sent message!'</span>, msg);</span><br><span class="line">        <span class="built_in">console</span>.groupEnd();</span><br><span class="line">    &#125;</span><br><span class="line">    sendMessage() &#123;</span><br><span class="line">        <span class="keyword">this</span>.pubsub.publish(<span class="string">'message'</span>, <span class="string">'Hey, how are you?'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> room = <span class="keyword">new</span> ChatRoom();</span><br><span class="line">room.sendMessage();</span><br></pre></td></tr></table></figure>
<h2 id="适配器模式（接口转换）"><a href="#适配器模式（接口转换）" class="headerlink" title="适配器模式（接口转换）"></a>适配器模式（接口转换）</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// normal</span></span><br><span class="line"><span class="keyword">var</span> LoggerFactory = &#123;</span><br><span class="line">    getLogger: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">window</span>.console</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> logger = LoggerFactory.getLogger()</span><br><span class="line">logger(<span class="string">'iroman sucks'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// adapter </span></span><br><span class="line"><span class="keyword">var</span> AjaxLogger = &#123;</span><br><span class="line">    sendLog: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = <span class="keyword">this</span>.urlEncode(<span class="built_in">arguments</span>)</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: <span class="string">'http://leonzh.cc/api/log'</span>,</span><br><span class="line">            data: data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 适配器 转换接口用</span></span><br><span class="line"><span class="keyword">var</span> AjaxLoggerAdapter = &#123;</span><br><span class="line">    log: fuction(arg) &#123;</span><br><span class="line">        AjaxLogger.sendLog(arg)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> LoggerFactory2 = &#123;</span><br><span class="line">    getLogger: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> AjaxLoggerAdapter</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> logger = LoggerFactory2.getLogger()</span><br><span class="line">logger(<span class="string">'iroman sucks'</span>)</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 装饰器模式</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="comment">// 装饰者</span></span><br><span class="line"><span class="keyword">var</span> decorate = <span class="function"><span class="keyword">function</span>(<span class="params">id, fn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取事件源</span></span><br><span class="line">  <span class="keyword">var</span> dom = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 若事件源已绑定事件</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> dom.onclick === <span class="string">'function'</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 缓存事件源原有事件</span></span><br><span class="line">    <span class="keyword">var</span> oldClickFn = dom.onclick;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为事件源定义新的事件</span></span><br><span class="line">    dom.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 事件源原有回调函数</span></span><br><span class="line">      oldClickFn();</span><br><span class="line">      <span class="comment">// 执行事件源新增回调函数</span></span><br><span class="line">      fn();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果未绑定事件，直接为事件源添加事件</span></span><br><span class="line">    dom.onclick = fn;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 电话输入框功能装饰</span></span><br><span class="line">decorate(<span class="string">'tel_input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'tel_demo_text'</span>).style.display = <span class="string">'none'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 与适配器模式的区别：</span></span><br><span class="line"><span class="comment">// 适配器方法使对原有对象适配，添加的方法与原有方法功能上大致相似。但是装饰者提供的方法与原来的方法功能项是有一定区别的。</span></span><br><span class="line"><span class="comment">// 在装饰者模式中，不需要了解对象原有的功能，而且对象原有的方法照样可以原封不动的使用</span></span><br><span class="line"><span class="comment">// 在适配器中增加的方法要调用原有的方法，需要了解原有方法实现的具体细节，而在装饰者中原封不动的使用，不需要知道原有方法实现的具体细节。</span></span><br></pre></td></tr></table></figure>
<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Batmobile</span> </span>&#123;</span><br><span class="line">    drive() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'driving'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BatmobileProxy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(driver) &#123;</span><br><span class="line">        <span class="keyword">this</span>.driver = driver</span><br><span class="line">    &#125;</span><br><span class="line">    drive() &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.driver.age &lt; <span class="number">18</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"too young to drive"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Batmobile().drive();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Driver</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> batman = <span class="keyword">new</span> Driver(<span class="number">45</span>)</span><br><span class="line"><span class="keyword">const</span> batmanInMobile = <span class="keyword">new</span> BatmobileProxy(batman)</span><br><span class="line">batmanInMobile.drive()</span><br><span class="line"><span class="keyword">const</span> robin = <span class="keyword">new</span> Driver(<span class="number">15</span>)</span><br><span class="line"><span class="keyword">const</span> robinInMobile = <span class="keyword">new</span> BatmobileProxy(robin)</span><br><span class="line">robinInMobile.drive()</span><br></pre></td></tr></table></figure>
<h2 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> forEach = <span class="function">(<span class="params"> ary, fn </span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>, l = ary.length; i &lt; l; i++ )&#123;</span><br><span class="line">        <span class="keyword">var</span> c = ary[ i ];</span><br><span class="line">        <span class="keyword">if</span> ( fn.call( c, i, c ) === <span class="literal">false</span> )&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">forEach([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], (item) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 外观模式</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShopFacade</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.discount = <span class="keyword">new</span> Discount();</span><br><span class="line">        <span class="keyword">this</span>.shipping = <span class="keyword">new</span> Shipping();</span><br><span class="line">        <span class="keyword">this</span>.fees = <span class="keyword">new</span> Fees();</span><br><span class="line">    &#125;</span><br><span class="line">    calc(price) &#123;</span><br><span class="line">        price = <span class="keyword">this</span>.discount.calc(price);</span><br><span class="line">        price = <span class="keyword">this</span>.fees.calc(price);</span><br><span class="line">        price += <span class="keyword">this</span>.shipping.calc();</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Discount</span> </span>&#123;</span><br><span class="line">    calc(value) &#123;</span><br><span class="line">        <span class="keyword">return</span> value * <span class="number">0.9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shipping</span> </span>&#123;</span><br><span class="line">    calc() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fees</span> </span>&#123;</span><br><span class="line">    calc(value) &#123;</span><br><span class="line">        <span class="keyword">return</span> value * <span class="number">1.05</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Visitor = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    splice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 获取参数，从第二个方法算起</span></span><br><span class="line">        <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.splice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对第一个参数执行splice方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.splice.apply(<span class="built_in">arguments</span>[<span class="number">0</span>], args);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    push: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 获取参数，从第二个方法算起</span></span><br><span class="line">        <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.splice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.push.apply(<span class="built_in">arguments</span>[<span class="number">0</span>], args);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    pop: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.pop.apply(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(a.length);</span><br><span class="line"></span><br><span class="line">Visitor.push(a, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a.length);</span><br><span class="line"></span><br><span class="line">Visitor.push(a, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'push:'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="built_in">console</span>.log(a.length);</span><br><span class="line"></span><br><span class="line">Visitor.pop(a);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'pop:'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="built_in">console</span>.log(a.length);</span><br><span class="line"></span><br><span class="line">Visitor.splice(a, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'splice:'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="built_in">console</span>.log(a.length);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindIEEvent</span>(<span class="params">dom, type, fn, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = data || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  dom.attachEvent(<span class="string">'on'</span> + type, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    fn.call(dom, e, data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h2><blockquote>
<p>对象结构型模式运用共享技术有效地支持大量细粒度的对象<br>它使用共享物件，用来尽可能减少内存使用量以及分享资讯给尽可能多的相似物件；它适合用于当大量物件只是重复因而导致无法令人接受的使用大量内存。通常物件中的部分状态是可以分享。常见做法是把它们放在外部数据结构，当需要使用时再将它们传递给享元。<br><code>demo见fe-basic</code><br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Color</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> colorFactory = &#123;</span><br><span class="line">    colors: &#123;&#125;,</span><br><span class="line">    create: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> color = <span class="keyword">this</span>.colors[name];</span><br><span class="line">        <span class="keyword">if</span>(color) <span class="keyword">return</span> color;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.colors[name] = <span class="keyword">new</span> Color(name);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.colors[name];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Equipment</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Equipment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    getPrice() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.price || <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setName(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- composite ---</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Composite</span> <span class="keyword">extends</span> <span class="title">Equipment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.equipments = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    add(equipment) &#123;</span><br><span class="line">        <span class="keyword">this</span>.equipments.push(equipment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getPrice() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.equipments.map(<span class="function"><span class="params">equipment</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> equipment.getPrice();</span><br><span class="line">        &#125;).reduce(<span class="function">(<span class="params">a, b</span>)  =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>  a + b;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cabbinet</span> <span class="keyword">extends</span> <span class="title">Composite</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.setName(<span class="string">'cabbinet'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- leafs ---</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FloppyDisk</span> <span class="keyword">extends</span> <span class="title">Equipment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.setName(<span class="string">'Floppy Disk'</span>);</span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">70</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HardDrive</span> <span class="keyword">extends</span> <span class="title">Equipment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.setName(<span class="string">'Hard Drive'</span>);</span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">250</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Memory</span> <span class="keyword">extends</span> <span class="title">Equipment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.setName(<span class="string">'Memory'</span>);</span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">280</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Batman = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _currentState = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 动作与状态方法映射</span></span><br><span class="line">  <span class="keyword">var</span> states = &#123;</span><br><span class="line">    jump: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 跳跃</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'jump'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    move: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 移动</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'move'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    shoot: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 射击</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'shoot'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    squat: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 蹲下</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'squat'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 动作控制类</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    change: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> arg = <span class="built_in">arguments</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 重置内部状态</span></span><br><span class="line">      _currentState = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (arg.length) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arg.length; i++) &#123;</span><br><span class="line">          _currentState[arg[i]] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    goes: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'触发一次动作'</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> _currentState) &#123;</span><br><span class="line">        states[i] &amp;&amp; states[i]();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> batman = <span class="keyword">new</span> Batman();</span><br><span class="line">batman.change(<span class="string">'jump'</span>, <span class="string">'shoot'</span>).goes().goes().change(<span class="string">'shoot'</span>).goes();</span><br></pre></td></tr></table></figure>
<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> InputStrategy = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> strategy = &#123;</span><br><span class="line">    isNumber: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(value) === <span class="string">'[object Array]'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    phone: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="regexp">/^1[3578]\d&#123;9&#125;$/</span>.test(value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    check: <span class="function"><span class="keyword">function</span>(<span class="params">type, value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 去除首尾空白符</span></span><br><span class="line">      value = value.replace(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> strategy[type] ? strategy[type](value) : <span class="string">'没有该类型的检测方法'</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加策略</span></span><br><span class="line">    addStrategy: <span class="function"><span class="keyword">function</span>(<span class="params">type, fn</span>) </span>&#123;</span><br><span class="line">      strategy[type] = fn;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">InputStrategy.addStrategy(<span class="string">'mail'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^(\w+)(@\w+)(\.\w+)+$/</span>.test(value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> is = InputStrategy.check(<span class="string">'mail'</span>, <span class="string">'abc@gmail.com'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(is);</span><br></pre></td></tr></table></figure>
<h2 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h2><ul>
<li>一个对象A向另一个对象B发起请求，如果B不处理，可以把请求转给C，如果C不处理，又可以把请求转给D。一直到有一个对象愿意处理这个请求为止</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Checker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(next) &#123;</span><br><span class="line">        <span class="keyword">this</span>._next = next</span><br><span class="line">    &#125;</span><br><span class="line">    handle(context) &#123;</span><br><span class="line">        <span class="keyword">this</span>._context = context;</span><br><span class="line">        <span class="keyword">if</span>( <span class="keyword">this</span>.support() )&#123;</span><br><span class="line">            <span class="keyword">this</span>.handleInternal();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>._next) &#123;</span><br><span class="line">            <span class="keyword">this</span>._next.handle( <span class="keyword">this</span>._context );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    handleInternal() &#123;&#125;</span><br><span class="line">    support() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> RangeChecker, NumberChecker, EmptyChecker;</span><br><span class="line"></span><br><span class="line">RangeChecker = <span class="keyword">new</span> Checker()</span><br><span class="line">RangeChecker.handleInternal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'RangeChecker.handleInternal: '</span>+<span class="keyword">this</span>._context.value);</span><br><span class="line">&#125;</span><br><span class="line">RangeChecker.support = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._context.value &gt; <span class="number">60</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NumberChecker = <span class="keyword">new</span> Checker(RangeChecker)</span><br><span class="line">NumberChecker.handleInternal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'NumberChecker.handleInternal: '</span>+<span class="keyword">this</span>._context.value);</span><br><span class="line">&#125;</span><br><span class="line">NumberChecker.support = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">isNaN</span>(<span class="keyword">this</span>._context.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EmptyChecker = <span class="keyword">new</span> Checker(NumberChecker)</span><br><span class="line">EmptyChecker.handleInternal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'EmptyChecker.handleInternal: '</span>+<span class="keyword">this</span>._context.value);</span><br><span class="line">&#125;</span><br><span class="line">EmptyChecker.support = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="keyword">this</span>._context.value || <span class="keyword">this</span>._context.value==<span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EmptyChecker.handle(&#123;&#125;);</span><br><span class="line">EmptyChecker.handle(&#123;<span class="attr">value</span>: <span class="string">'sd'</span>&#125;);</span><br><span class="line">EmptyChecker.handle(&#123;<span class="attr">value</span>: <span class="number">34</span>&#125;);</span><br><span class="line">EmptyChecker.handle(&#123;<span class="attr">value</span>: <span class="number">134</span>&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><ul>
<li>某些对象发送请求，但是并不知道请求的接收者是谁，也不知道被请求的操作是什么</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> CommandUtil = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> Action = &#123;</span><br><span class="line">        run: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'do run'</span>),</span><br><span class="line">        swim: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'do swim'</span>),</span><br><span class="line">        study: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'do study'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">command</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Action[command.cd] ? Action[command.cd]() : <span class="string">'nothing'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">CommandUtil(&#123; <span class="attr">cd</span>: <span class="string">'run'</span> &#125;)</span><br></pre></td></tr></table></figure>
<h2 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h2><p><code>订阅发布模式用到了</code></p>
<h2 id="备忘录模式（缓存模式）"><a href="#备忘录模式（缓存模式）" class="headerlink" title="备忘录模式（缓存模式）"></a>备忘录模式（缓存模式）</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 上下页</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Page</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cache = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">page, fn</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 如果有缓存</span></span><br><span class="line">    <span class="keyword">if</span> (cache[page]) &#123;</span><br><span class="line">      fn &amp;&amp; fn(cache[page]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $.get(<span class="string">'./data/getxxx'</span>).success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        cache[page] = data;</span><br><span class="line">        fn &amp;&amp; fn(data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="迭代器模式（Iterator）"><a href="#迭代器模式（Iterator）" class="headerlink" title="迭代器模式（Iterator）"></a>迭代器模式（Iterator）</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// forEach</span></span><br><span class="line"><span class="keyword">var</span> forEach = <span class="function"><span class="keyword">function</span>(<span class="params">arr, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    fn(arr[i], i, arr);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">forEach([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], <span class="function"><span class="keyword">function</span>(<span class="params">item, i, arr</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item, i, arr);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象迭代</span></span><br><span class="line"><span class="keyword">var</span> eachObject = <span class="function"><span class="keyword">function</span>(<span class="params">obj, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    fn(obj[i], i, obj);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">eachObject(&#123;<span class="attr">a</span>: <span class="string">'123'</span>, <span class="attr">b</span>: <span class="string">'456'</span>, <span class="attr">c</span>: <span class="string">'789'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">item, key, obj</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item, key, obj);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取值器</span></span><br><span class="line"><span class="keyword">var</span> superHero = &#123;</span><br><span class="line">    male: &#123;</span><br><span class="line">        america: &#123;</span><br><span class="line">            gotham: <span class="string">'Batman'</span>,</span><br><span class="line">            metropolis: <span class="string">'Superman'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        china: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    female: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getter = <span class="function">(<span class="params">data, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!data) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">var</span> result = data</span><br><span class="line">    <span class="keyword">var</span> keys = key.split(<span class="string">'.'</span>)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(result[keys[i]]) &#123;</span><br><span class="line">            result = result[keys[i]]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line">getter(superHero, <span class="string">'male.america.gotham'</span>) <span class="comment">// Batman</span></span><br></pre></td></tr></table></figure>
<h2 id="解释器"><a href="#解释器" class="headerlink" title="解释器"></a>解释器</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sum</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(left, right) &#123;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">    interpret() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.left.interpret() + <span class="keyword">this</span>.right.interpret();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Min</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(left, right) &#123;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    interpret() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.left.interpret() - <span class="keyword">this</span>.right.interpret();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Num</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(val) &#123;</span><br><span class="line">        <span class="keyword">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    interpret() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> sum = <span class="keyword">new</span> Sum(<span class="keyword">new</span> Num(<span class="number">2</span>), <span class="keyword">new</span> Num(<span class="number">3</span>))</span><br><span class="line">sum.interpret()</span><br></pre></td></tr></table></figure>
<h2 id="惰性模式（layier）"><a href="#惰性模式（layier）" class="headerlink" title="惰性模式（layier）"></a>惰性模式（layier）</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> A = &#123;&#125;</span><br><span class="line">A.on = <span class="function"><span class="keyword">function</span>(<span class="params">dom, type, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (dom.addEventListener) &#123;</span><br><span class="line">    A.on = <span class="function"><span class="keyword">function</span>(<span class="params">dom, type, fn</span>) </span>&#123;</span><br><span class="line">      dom.addEventListener(type, fn, <span class="literal">false</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dom.attachEvent) &#123;</span><br><span class="line">    A.on = <span class="function"><span class="keyword">function</span>(<span class="params">dom, type, fn</span>) </span>&#123;</span><br><span class="line">      dom.attachEvent(type, fn);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    A.on = <span class="function"><span class="keyword">function</span>(<span class="params">dom, type, fn</span>) </span>&#123;</span><br><span class="line">      dom[<span class="string">'on'</span> + type] = fn;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  A.on(dom, type, fn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(A.on)</span><br><span class="line"></span><br><span class="line">A.on(<span class="built_in">document</span>, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(A.on)</span><br></pre></td></tr></table></figure>
<h2 id="参与者模式（bind-curry）"><a href="#参与者模式（bind-curry）" class="headerlink" title="参与者模式（bind, curry）"></a>参与者模式（bind, curry）</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// curring</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line">  <span class="keyword">var</span> args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> addArgs = slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">var</span> allArgs = args.concat(addArgs);</span><br><span class="line">    <span class="keyword">return</span> fn.apply(<span class="literal">null</span>, allArgs);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test = curry(add, <span class="number">5</span>);</span><br><span class="line"><span class="built_in">console</span>.log(test(<span class="number">5</span>)); <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<h2 id="等待者模式（Promise）"><a href="#等待者模式（Promise）" class="headerlink" title="等待者模式（Promise）"></a>等待者模式（Promise）</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Waiter = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dfd = [];</span><br><span class="line">  <span class="keyword">var</span> doneArr = [];</span><br><span class="line">  <span class="keyword">var</span> failArr = [];</span><br><span class="line">  <span class="keyword">var</span> slice = <span class="built_in">Array</span>.prototype.slice;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Primise = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 监控对象是否解决成功状态</span></span><br><span class="line">    <span class="keyword">this</span>.resolved = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 监控对象是否解决失败状态</span></span><br><span class="line">    <span class="keyword">this</span>.rejected = <span class="literal">false</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  Primise.prototype = &#123;</span><br><span class="line">    resolve: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.resolved = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!dfd.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = dfd.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// 如果有任意一个监控对象没有被解决或者解决失败则返回</span></span><br><span class="line">        <span class="keyword">if</span> (dfd[i] &amp;&amp; !dfd[i].resolved || dfd[i].rejected) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// 清除监控对象</span></span><br><span class="line">        dfd.splice(i, <span class="number">1</span>);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      _exec(doneArr);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    reject: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.rejected = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!dfd.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      dfd.splice(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      _exec(failArr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  self.Deferred = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Primise();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_exec</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        arr[i] &amp;&amp; arr[i]();</span><br><span class="line">      &#125; <span class="keyword">catch</span>(e) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * 监控异步方法</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * @param 监控对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  self.when = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    dfd = slice.call(<span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = dfd.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!dfd[i] || dfd[i].resolved || dfd[i].rejected || !dfd[i] <span class="keyword">instanceof</span> Primise) &#123;</span><br><span class="line">        dfd.splice(i, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加成功回调函数的方法</span></span><br><span class="line">  self.done = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    doneArr = doneArr.concat(slice.call(<span class="built_in">arguments</span>));</span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加失败回调函数的方法</span></span><br><span class="line">  self.fail = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    failArr = failArr.concat(slice.call(<span class="built_in">arguments</span>));</span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> waiter = <span class="keyword">new</span> Waiter();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> first = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dtd = waiter.Deferred();</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'first finish'</span>);</span><br><span class="line">    dtd.resolve();</span><br><span class="line">  &#125;, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dtd;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> second = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dtd = waiter.Deferred();</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'second finish'</span>);</span><br><span class="line">    dtd.resolve();</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dtd;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">waiter.when(first, second).done(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'success'</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'success again'</span>);</span><br><span class="line">&#125;).fail(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'fail'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="同步模块模式"><a href="#同步模块模式" class="headerlink" title="同步模块模式"></a>同步模块模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> L = L || &#123;&#125;</span><br><span class="line">L.define = <span class="function"><span class="keyword">function</span>(<span class="params">str, fun</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>[str] = fun()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">L.module = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">var</span> fn = args.pop()</span><br><span class="line">    <span class="keyword">var</span> modules = []</span><br><span class="line">    <span class="keyword">var</span> moduleNames = args.shift()</span><br><span class="line">    moduleNames.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        modules.push(<span class="keyword">this</span>[item])</span><br><span class="line">    &#125;)</span><br><span class="line">    fn.apply(<span class="literal">null</span>, modules)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">L.define(<span class="string">'string'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    trim: <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> str.replace(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">''</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">L.module([<span class="string">'string'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">string</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log( string.trim(<span class="string">' 测试一下 '</span>) );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="异步模块模式"><a href="#异步模块模式" class="headerlink" title="异步模块模式"></a>异步模块模式</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">F</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> moduleCache = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> getUrl = <span class="function"><span class="keyword">function</span> (<span class="params">moduleName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(moduleName).replace(<span class="regexp">/\.js$/g</span>, <span class="string">''</span>) + <span class="string">'.js'</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> loadScript = <span class="function"><span class="keyword">function</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    _script.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">    _script.charset = <span class="string">'UTF-8'</span>;</span><br><span class="line">    _script.async = <span class="literal">true</span>;</span><br><span class="line">    _script.src = src;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>].appendChild(_script);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> loadModule = <span class="function"><span class="keyword">function</span> (<span class="params">moduleName, cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _module;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (moduleCache[moduleName]) &#123;</span><br><span class="line">      _module = moduleCache[moduleName];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (_module.status === <span class="string">'loaded'</span>) &#123;</span><br><span class="line">        setTimeout(cb(_module.exports), <span class="number">0</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _module.onload.push(cb);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      moduleCache[moduleName] = &#123;</span><br><span class="line">        moduleName: moduleName,</span><br><span class="line">        status: <span class="string">'loading'</span>,</span><br><span class="line">        exports: <span class="literal">null</span>,</span><br><span class="line">        onload: [cb]</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      loadScript(getUrl(moduleName));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> setModule = <span class="function"><span class="keyword">function</span> (<span class="params">moduleName, params, cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _module, fn;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (moduleCache[moduleName]) &#123;</span><br><span class="line">      _module = moduleCache[moduleName];</span><br><span class="line">      _module.status = <span class="string">'loaded'</span>;</span><br><span class="line">      _module.exports = cb ? cb.apply(_module, params) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (fn = _module.onload.shift()) &#123;</span><br><span class="line">        fn(_module.exports);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      cb &amp;&amp; cb.apply(<span class="literal">null</span>, params);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  F.module = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">var</span> callback = args.pop();</span><br><span class="line">    <span class="keyword">var</span> deps = (args.length &amp;&amp; args[args.length - <span class="number">1</span>] <span class="keyword">instanceof</span> <span class="built_in">Array</span>) ? args.pop() : [];</span><br><span class="line">    <span class="keyword">var</span> url = args.length ? args.pop() : <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> params = [];</span><br><span class="line">    <span class="keyword">var</span> depsCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> len;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len = deps.length) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">          depsCount++;</span><br><span class="line">          loadModule(deps[i], <span class="function"><span class="keyword">function</span> (<span class="params">mod</span>) </span>&#123;</span><br><span class="line">            params[i] = mod;</span><br><span class="line">            depsCount--;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (depsCount === <span class="number">0</span>) &#123;</span><br><span class="line">              setModule(url, params, callback);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)(i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      setModule(url, [], callback);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)((<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">window</span>.F = &#123;&#125;;</span><br><span class="line">&#125;)());</span><br></pre></td></tr></table></figure>
    
  </div>
</article>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2016/05/30/yhtSpringOuting/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2016/10/11/a-little-game/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/atom.xml"
              rel="noopener noreferrer"
              target="_blank"
              >
              RSS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'leonzhang1108';
    
    var disqus_url = 'http://6rina.cc/2016/06/04/js-design-pattern/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//leonzhang1108.disqus.com/count.js" async></script>



    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
